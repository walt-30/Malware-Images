import os

malwareDir = '../../DataSet/malware/'
bytesDir = '../../DataSet/bytes/'

## Inserts spaces into a string to match the following pattern
## '01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16
##  01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 ...'
def format_hex(string):
    newstring = ''
    counter = 0
    currentLine = ''
    for y in string:
        #save 32 characters to variable
        #then process those as separate line
        if counter % 32 == 0 and counter > 0:
            linecounter = 0
            for x in currentLine:
                newstring = newstring + x
                if linecounter % 2 != 0 and linecounter < 31:
                    #add space after every 2 char
                    newstring = newstring + ' '
                if linecounter == 31:
                    #add linebreak at the end of the line
                    newstring = newstring + '\n'
                linecounter += 1
            counter = 0
            currentLine = ''
        currentLine = currentLine + y
        counter += 1
    return newstring

malwares = os.listdir(malwareDir)

# loop through all files in the malware directory and process them one by one
for counter, name in enumerate(malwares):
    print('processing ' + name)
    exeFile = open(malwareDir + name,'rb')
    hexData = bytes.hex(exeFile.read())
    with open(bytesDir + name + '.bytes', 'x') as f:
        f.write(format_hex(hexData))

print('done')
print('files are saved to ' + bytesDir)
