
import pyzipper
import os
import concurrent.futures

zip_password = b'infected'
malware_path = '../../DataSet/malware/'
malwares = os.listdir(malware_path)

def unzip_file(file):
    try:
        with pyzipper.AESZipFile(file) as zf:
            zf.pwd = zip_password
            my_secrets = zf.extractall(malware_path)
    except:
        print('ERROR: failed to extract: ' + file)

def unpack(file_name):
    print('unzipping ' + file_name)
    unzip_file(malware_path + file_name)
    os.remove(malware_path + file_name)

# loop through all files in the malware directory unpack them and delete the .zip file
# all using multithreading
with concurrent.futures.ThreadPoolExecutor() as executor:
    executor.map(unpack, malwares)

print('done')
