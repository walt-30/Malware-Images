
import pyzipper
import os
import concurrent.futures

ZIP_PASSWORD = b'infected'
MALWARE_PATH = '../../DataSet/malware/'
MALWARES = os.listdir(MALWARE_PATH)

def unzip_file(file):
    try:
        with pyzipper.AESZipFile(file) as zf:
            zf.pwd = ZIP_PASSWORD
            my_secrets = zf.extractall(MALWARE_PATH)
    except:
        print(f'ERROR: failed to extract: {file}')

def unpack(file_name):
    print(f'unzipping {file_name}')
    unzip_file(MALWARE_PATH + file_name)
    os.remove(MALWARE_PATH + file_name)


# loop through all files in the malware directory unpack them and delete the .zip file
# all using multithreading
with concurrent.futures.ThreadPoolExecutor() as executor:
    executor.map(unpack, MALWARES)

print('done')
